document.addEventListener("DOMContentLoaded",()=>{function a(t,r){"granted"===Notification.permission?new Notification(t,{body:r,icon:"/TCM/assets/other/TCM-ICON.png"}):"denied"!==Notification.permission&&Notification.requestPermission().then(e=>{"granted"===e&&new Notification(t,{body:r,icon:"/TCM/assets/other/TCM-ICON.png"})})}function e(){fetch("/TCM/js/data.min.js").then(e=>e.json()).then(e=>{{var t=e;let r=JSON.parse(localStorage.getItem("carsData"))||{cars:[]};var o=t.cars.filter(t=>!r.cars.some(e=>e.id===t.id)),n=t.cars.filter(t=>{var e=r.cars.find(e=>e.id===t.id);return e&&JSON.stringify(e)!==JSON.stringify(t)});o.forEach(e=>{a("Nuevo auto agregado",`Se agregaron los ajustes del ${e.name}. ¡Échales un ojo!`)}),n.forEach(e=>{a("Actualización de ajustes",`Se actualizaron los ajustes del ${e.name}.`)}),localStorage.setItem("carsData",JSON.stringify(t))}window.carsData=e,g()}).catch(e=>{console.error("Error al cargar los datos dinámicamente:",e)})}document.startViewTransition||(document.startViewTransition=e=>e()),"granted"!==Notification.permission&&Notification.requestPermission(),e(),setInterval(()=>{e()},6e4);let l=document.getElementById("carGrid"),c=document.getElementById("categoryTabs"),i=document.getElementById("carCardTemplate"),s=document.getElementById("brandSliderTemplate"),d=document.getElementById("searchInput"),t=document.getElementById("categorySlider"),r=document.getElementById("clearSearch"),o=document.getElementById("matchCount"),u=!1,m=null,f=["Street Tire 1","Street Tire 2","Drift","Racing","Hypercar","Alpha GP","Motocross","Rally Raid","Rally","Monster"];function g(){var e,t=new URLSearchParams(window.location.search).get("category"),r=[...new Set(carsData.cars.map(e=>e.category))].sort((e,t)=>f.indexOf(e)-f.indexOf(t));e=r,c.innerHTML="",e.forEach((e,t)=>{var r=document.createElement("button");r.className="tab-button "+(e===m?"active":""),r.textContent=e,r.addEventListener("click",()=>{u=!1,m=e,d.value="",h(),p(e)}),c.appendChild(r)});{let e=document.querySelector(".category-slider"),o=e.querySelector(".tabs"),t=e.querySelector(".prev"),r=e.querySelector(".next"),n=0;function a(){var e,t,r=o.querySelector(".tab-button.active");r&&(0===(t=(e=Array.from(o.querySelectorAll(".tab-button"))).indexOf(r))?o.scrollLeft=0:t===e.length-1?o.scrollLeft=o.scrollWidth:(t=r.getBoundingClientRect(),e=o.getBoundingClientRect(),r=t.left+t.width/2,t=e.left+e.width/2,o.scrollLeft+=r-t))}r.addEventListener("click",()=>{(n+=100)>o.scrollWidth-o.clientWidth&&(n=o.scrollWidth-o.clientWidth),o.scrollTo({left:n,behavior:"smooth"})}),t.addEventListener("click",()=>{(n-=100)<0&&(n=0),o.scrollTo({left:n,behavior:"smooth"})}),o.addEventListener("scroll",()=>{n=o.scrollLeft}),o.querySelectorAll(".tab-button").forEach(e=>{e.addEventListener("click",()=>{setTimeout(a,50)})}),setTimeout(a,100)}let o,n=(o=t&&r.includes(t)?t:(e=localStorage.getItem("currentCategory"))&&r.includes(e)?e:r[0],m=o,localStorage.getItem("lastSearch"));setTimeout(()=>{n&&""!==n.trim()?(d.value=n,u=!0,b(n)):p(o);var e=localStorage.getItem("scrollPosition"),t=localStorage.getItem("categoryScrollPosition");e&&window.scrollTo(0,Number.parseInt(e)),t&&(document.querySelector(".category-slider .tabs").scrollLeft=Number.parseInt(t)),h()},50)}function h(){r.style.display=d.value?"block":"none",o.style.display=d.value?"block":"none",t.style.display=d.value?"none":"flex",document.querySelector(".search-container").style.left=d.value?"-23px":"0px",d.value||(d.style.border="solid 1px #ffffff17")}function y(e,t){if(!t||0===t.length)return e;let r=e;return t.forEach(e=>{0<e.length&&(e=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),e=new RegExp(`(${e})`,"gi"),r=r.replace(e,'<span class="highlight">$1</span>'))}),r}function v(e,t=[]){var r=i.content.cloneNode(!0),o=r.querySelector(".car-image");o.src=e.image,o.alt=e.name,o.style.viewTransitionName="car-image-"+e.id,r.querySelector(".brand-logo").src=e.brand.logo,r.querySelector(".brand-logo").alt=e.brand.name;r.querySelector(".car-name").innerHTML=y(e.name,t);var o=r.querySelector(".car-details"),n=e.brand.name+" • "+e.year;o.innerHTML=y(n,t);r.querySelector(".car-description").innerHTML=y(e.description,t);o=r.querySelector(".car-card");return o.addEventListener("click",()=>{localStorage.setItem("viewingCarId",e.id),localStorage.setItem("scrollPosition",window.scrollY),localStorage.setItem("categoryScrollPosition",document.querySelector(".category-slider .tabs").scrollLeft),""!==d.value.trim()?localStorage.setItem("lastSearch",d.value):localStorage.removeItem("lastSearch"),localStorage.setItem("currentCategory",m||document.querySelector(".tab-button.active")?.textContent||f[0]),document.startViewTransition?document.startViewTransition(()=>{window.location.href="car-details.html?id="+encodeURIComponent(e.id)}):window.location.href="car-details.html?id="+encodeURIComponent(e.id)}),o}function b(e){if(e){0<e.length&&(m=m||document.querySelector(".tab-button.active")?.textContent||f[0],document.querySelectorAll(".tab-button").forEach(e=>{e.classList.remove("active")}));let n=e.split(/\s+/).filter(e=>0<e.length);var r=carsData.cars.filter(e=>{let t=[e.name.toLowerCase(),e.brand.name.toLowerCase(),e.category.toLowerCase(),e.description.toLowerCase(),e.year.toString()].join(" ");return n.every(e=>t.includes(e))});if(o&&(o.textContent=r.length.toString(),o.style.color=0<r.length?"#00ff00":"#ff0000"),0<r.length){let t=r.reduce((e,t)=>(e[t.brand.name]||(e[t.brand.name]=[]),e[t.brand.name].push(t),e),{});l.innerHTML="",Object.keys(t).sort((e,t)=>e.localeCompare(t)).forEach(e=>{var r=t[e];if(0<r.length){var o=s.content.cloneNode(!0);o.querySelector(".brand-name").textContent=e;let t=o.querySelector(".slider-content");r.forEach(e=>{e=v(e,n);t.appendChild(e)}),l.appendChild(o),S(l.lastElementChild)}}),d.style.border="solid 1px #ffffff17",o.style.border="solid 1px #ffffff91"}else d.style.border="solid 1px #ec0b0b",o.style.border="solid 1px #ec0b0b",l.innerHTML=`
        <div class="no-results">
          <p>No se encontraron autos que coincidan con "${e}"</p>
          <button class="newIssue" onclick="window.location.href='https://github.com/EDDIT8/TCM/issues/new?template=solicitud_de_ajustes.yml';" arial-label="Solicitar auto">Solicitar Ajustes <svg xmlns="http://www.w3.org/2000/svg" width="15px" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25" />
          </svg>
          </button>
        </div>
      `}else u&&(u=!1,m?p(m):p(f[0])),d.style.border="solid 1px #ffffff17"}function p(t){m=t,document.querySelectorAll(".tab-button").forEach(e=>{e.classList.toggle("active",e.textContent===t)});let n=carsData.cars.filter(e=>e.category===t).reduce((e,t)=>(e[t.brand.name]||(e[t.brand.name]=[]),e[t.brand.name].push(t),e),{});var e=Object.keys(n).sort((e,t)=>e.localeCompare(t));l.innerHTML="",e.forEach(e=>{var t=n[e],r=s.content.cloneNode(!0);r.querySelector(".brand-name").textContent=e;let o=r.querySelector(".slider-content");t.forEach(e=>{e=v(e);o.appendChild(e)}),l.appendChild(r),S(l.lastElementChild)}),localStorage.setItem("currentCategory",t)}function S(e){let t=e.querySelector(".slider-content"),r=e.querySelector(".prev"),o=e.querySelector(".next"),n=0;function a(){r.style.display=0<t.scrollLeft?"block":"none",o.style.display=t.scrollLeft<t.scrollWidth-t.clientWidth?"block":"none"}o.addEventListener("click",()=>{(n+=200)>t.scrollWidth-t.clientWidth&&(n=t.scrollWidth-t.clientWidth),t.scrollTo({left:n,behavior:"smooth"}),a()}),r.addEventListener("click",()=>{(n-=200)<0&&(n=0),t.scrollTo({left:n,behavior:"smooth"}),a()}),t.addEventListener("scroll",()=>{n=t.scrollLeft,a()}),a()}g(),d.addEventListener("input",()=>{var e,t=d.value.toLowerCase().trim();(u=0<t.length)||(e=document.querySelector(".tab-button.active")?.textContent)&&(m=e),b(t),h()}),r.addEventListener("click",()=>{d.value="",u=!1,p(m||f[0]),h(),d.blur(),d.style.border="solid 1px #ffffff17"}),new MutationObserver(e=>{e.forEach(e=>{"childList"===e.type&&e.addedNodes.forEach(e=>{1===e.nodeType&&e.querySelectorAll(".car-image, .brand-logo").forEach(e=>{e.onerror=function(){this.src="/placeholder.svg"}})})})}).observe(document.body,{childList:!0,subtree:!0})}),"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/TCM/service-worker.js").then(e=>{console.log("ServiceWorker registrado con éxito:",e)}).catch(e=>{console.log("Error en el registro del ServiceWorker:",e)})});